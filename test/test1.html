<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Qunit Base Events</title>
    <link rel="stylesheet" href="https://code.jquery.com/qunit/qunit-2.11.3.css">
</head>
<body translate="no">
    


    <div id="qunit"></div>

    <div id="qunit-fixture"></div>

    <script src="https://code.jquery.com/qunit/qunit-2.11.3.js"></script>

    <script>
(function () {
	
    var root = this, _listening;

    const eventSplitter = /\s+/;

    const Base = {};

    const Events = {};
    
    Base.Events = Events;
    
    function extend(destination, from) { for (var prop in from) { if (from[prop]) { destination[prop] = from[prop]; } } return destination; }

    function eventsApi(iteratee, events, name, callback, opts) {
        var i = 0, names;
        if (name && typeof name === 'object') {
            if (callback !== void 0 && 'context' in opts && opts.context === void 0) opts.context = callback;
            for (names = Object.keys(name); i < names.length; i++) {
                events = eventsApi(iteratee, events, names[i], name[names[i]], opts);
            }
        } 
        else if (name && eventSplitter.test(name)) {
            for (names = name.split(eventSplitter); i < names.length; i++) {
                events = iteratee(events, names[i], callback, opts);
            }
        } 
        else {
            events = iteratee(events, name, callback, opts);
        }
        return events;
    };
     
    Events.on = function (name, callback, context) {
        this._events = eventsApi(onApi, this._events || {}, name, callback, {
            context: context,
            ctx: this,
            listening: _listening
        });
        if (_listening) {
            var listeners = this._listeners || (this._listeners = {});
            listeners[_listening.id] = _listening;
            _listening.interop = false;
        }
        return this;
    };

    function onApi(events, name, callback, options) {
        if (callback) {
            var handlers = events[name] || (events[name] = []);
            var context = options.context,
                ctx = options.ctx,
                listening = options.listening;
            if (listening) listening.count++;
            handlers.push({
                callback: callback,
                context: context,
                ctx: context || ctx,
                listening: listening
            });
        }
        return events;
    };

    Events.bind = Events.on;
    Events.unbind = Events.off;

    extend(Base, Events);

    Base.VERSION = "0.0.1";
    
    const History = (Base.History = function () {
        this.handlers = [];
        if (typeof window !== "undefined") {
            this.location = window.location;
            this.history = window.history;
        }
    });

    History.started = false;

    extend(History.prototype, Base.Events, {
        interval: 50
    })
    
    Base.history = new History();

	if (typeof exports !== "undefined") {
		if (typeof module !== "undefined" && module.exports) {
			exports = module.exports = Base;
		}
		exports.Base = Base;
	} else {
		root.Base = Base;
	}
	if (typeof define === "function" && define.amd) {
		define("Base", [], function () {
			return Base;
		});
    }    
}.call(this));
    </script>

    <script src='https://s3-us-west-2.amazonaws.com/s.cdpn.io/1674766/lodash.min.js'></script>

    <script id="rendered-js">
        QUnit.module('Base.Events');

        QUnit.test('on', function (assert) {
            const object = { count : 0 };
            _.extend(object, Base.Events);
            object.on("test", function(event){ object.counter += 1 });
            assert.equal(object.count, 0, ' count 0');
            console.log(object._events)
        })

        const q = {

            e0: function () {
                QUnit.test('on and trigger', function (assert) {
                    assert.expect(2);
                    var obj = {
                        counter: 0
                    };
                    _.extend(obj, Base.Events);
                    obj.on('event', function () {
                        obj.counter += 1;
                    });
                    obj.trigger('event');
                    assert.equal(obj.counter, 1, 'counter should be incremented.');
                    obj.trigger('event');
                    obj.trigger('event');
                    obj.trigger('event');
                    obj.trigger('event');
                    assert.equal(obj.counter, 5, 'counter should be incremented five times.');
                });
            },

            e1: function () {
                QUnit.test('binding and triggering multiple events', function (assert) {
                    assert.expect(4);
                    var obj = {
                        counter: 0
                    };
                    _.extend(obj, Base.Events);

                    obj.on('a b c', function () {
                        obj.counter += 1;
                    });

                    obj.trigger('a');
                    assert.equal(obj.counter, 1);

                    obj.trigger('a b');
                    assert.equal(obj.counter, 3);

                    obj.trigger('c');
                    assert.equal(obj.counter, 4);

                    obj.off('a c');
                    obj.trigger('a b c');
                    assert.equal(obj.counter, 5);
                });


            },

            e2: function () {
                QUnit.test('listenTo and stopListening', function (assert) {
                    assert.expect(1);
                    var a = _.extend({}, Base.Events);
                    var b = _.extend({}, Base.Events);
                    a.listenTo(b, 'all', function () {
                        assert.ok(true);
                    });
                    b.trigger('anything');
                    a.listenTo(b, 'all', function () {
                        assert.ok(false);
                    });
                    a.stopListening();
                    b.trigger('anything');
                });
            },
            e3: function () {
                //binding and triggering multiple event names with event maps
                QUnit.test('', function (assert) {});
            },
            e4: function () {
                //binding and trigger with event maps context
                QUnit.test('', function (assert) {});
            },
            e5: function () {
                //'listenTo and stopListening with event maps'
                QUnit.test('', function (assert) {});
            },
            e6: function () {
                //stopListening with omitted args
                QUnit.test('', function (assert) {});
            },
            e7: function () {
                //listenToOnce
                QUnit.test('', function (assert) {});
            },
            e8: function () {
                //
                QUnit.test('', function (assert) {});
            },
            e9: function () {
                QUnit.test('on and off', function (assert) {
                    var obj = _.extend({}, Base.Events);
                    //var obj2 = _.extend({}, Base.Events);
                    var fn = function () {};

                    //assert.equal(obj, obj.trigger('noeventssetyet'));
                    //assert.equal(obj, obj.off('noeventssetyet'));
                    //assert.equal(obj, obj.stopListening('noeventssetyet'));

                    assert.equal(obj, obj.on('a', fn), 'Event extended to Object');
                    //assert.equal(obj, obj.off('a'), 'Event removed from Object');

                    //assert.equal(obj, obj.once('a', fn));

                    //assert.equal(obj, obj.trigger('a'));
                    //assert.equal(obj, obj.listenTo(obj2, 'a', fn));
                    //assert.equal(obj, obj.listenToOnce(obj2, 'b', fn));

                    //assert.equal(obj, obj.stopListening(obj2, 'a'));
                    //assert.equal(obj, obj.stopListening());			
                });
            }

        };


        //q[obj]();	
        //q.e2();
        //q.e9();
    </script>



</body>

</html>
