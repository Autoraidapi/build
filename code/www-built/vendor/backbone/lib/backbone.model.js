!function(t,e){if("function"==typeof define&&define.amd)define(["backbone","underscore"],e);else if("undefined"!=typeof module&&module.exports){var i=require("backbone"),r=require("underscore");module.exports=e(i,r)}else e(t.Backbone,t._)}(this,function(t,e){var i=t.Model=function(t,i){var r=t||{};i||(i={}),this.preinitialize.apply(this,arguments),this.cid=e.uniqueId(this.cidPrefix),this.attributes={},i.collection&&(this.collection=i.collection),i.parse&&(r=this.parse(r,i)||{});var n=e.result(this,"defaults");r=e.defaults(e.extend({},n,r),n),this.set(r,i),this.changed={},this.initialize.apply(this,arguments)};e.extend(i.prototype,t.Events,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",preinitialize:function(){},initialize:function(){},toJSON:function(t){return e.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return e.escape(this.get(t))},has:function(t){return null!=this.get(t)},matches:function(t){return!!e.iteratee(t,this)(this.attributes)},set:function(t,i,r){if(null==t)return this;var n;if("object"==typeof t?(n=t,r=i):(n={})[t]=i,r||(r={}),!this._validate(n,r))return!1;var s=r.unset,u=r.silent,a=[],c=this._changing;this._changing=!0,c||(this._previousAttributes=e.clone(this.attributes),this.changed={});var o=this.attributes,h=this.changed,l=this._previousAttributes;for(var d in n)i=n[d],e.isEqual(o[d],i)||a.push(d),e.isEqual(l[d],i)?delete h[d]:h[d]=i,s?delete o[d]:o[d]=i;if(this.idAttribute in n&&(this.id=this.get(this.idAttribute)),!u){a.length&&(this._pending=r);for(var f=0;f<a.length;f++)this.trigger("change:"+a[f],this,o[a[f]],r)}if(c)return this;if(!u)for(;this._pending;)r=this._pending,this._pending=!1,this.trigger("change",this,r);return this._pending=!1,this._changing=!1,this},unset:function(t,i){return this.set(t,void 0,e.extend({},i,{unset:!0}))},clear:function(t){var i={};for(var r in this.attributes)i[r]=void 0;return this.set(i,e.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!e.isEmpty(this.changed):e.has(this.changed,t)},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&e.clone(this.changed);var i,r=this._changing?this._previousAttributes:this.attributes,n={};for(var s in t){var u=t[s];e.isEqual(r[s],u)||(n[s]=u,i=!0)}return!!i&&n},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return e.clone(this._previousAttributes)},fetch:function(t){t=e.extend({parse:!0},t);var i=this,r=t.success;return t.success=function(e){var n=t.parse?i.parse(e,t):e;if(!i.set(n,t))return!1;r&&r.call(t.context,i,e,t),i.trigger("sync",i,e,t)},s(this,t),this.sync("read",this,t)},save:function(t,i,r){var n;null==t||"object"==typeof t?(n=t,r=i):(n={})[t]=i,r=e.extend({validate:!0,parse:!0},r);var u=r.wait;if(n&&!u){if(!this.set(n,r))return!1}else if(!this._validate(n,r))return!1;var a=this,c=r.success,o=this.attributes;r.success=function(t){a.attributes=o;var i=r.parse?a.parse(t,r):t;if(u&&(i=e.extend({},n,i)),i&&!a.set(i,r))return!1;c&&c.call(r.context,a,t,r),a.trigger("sync",a,t,r)},s(this,r),n&&u&&(this.attributes=e.extend({},o,n));var h=this.isNew()?"create":r.patch?"patch":"update";"patch"!==h||r.attrs||(r.attrs=n);var l=this.sync(h,this,r);return this.attributes=o,l},destroy:function(t){t=t?e.clone(t):{};var i=this,r=t.success,n=t.wait,u=function(){i.stopListening(),i.trigger("destroy",i,i.collection,t)};t.success=function(e){n&&u(),r&&r.call(t.context,i,e,t),i.isNew()||i.trigger("sync",i,e,t)};var a=!1;return this.isNew()?e.defer(t.success):(s(this,t),a=this.sync("delete",this,t)),n||u(),a},url:function(){var t=e.result(this,"urlRoot")||e.result(this.collection,"url")||n();if(this.isNew())return t;var i=this.get(this.idAttribute);return t.replace(/[^\/]$/,"$&/")+encodeURIComponent(i)},parse:function(t,e){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},e.extend({},t,{validate:!0}))},_validate:function(t,i){if(!i.validate||!this.validate)return!0;t=e.extend({},this.attributes,t);var r=this.validationError=this.validate(t,i)||null;return!r||(this.trigger("invalid",this,r,e.extend(i,{validationError:r})),!1)}});var r=function(t,i){var r,n=this;return r=t&&e.has(t,"constructor")?t.constructor:function(){return n.apply(this,arguments)},e.extend(r,n,i),r.prototype=e.create(n.prototype,t),r.prototype.constructor=r,r.__super__=n.prototype,r};i.extend=r;var n=function(){throw new Error('A "url" property or function must be specified')},s=function(t,e){var i=e.error;e.error=function(r){i&&i.call(e.context,t,r,e),t.trigger("error",t,r,e)}};return i});
//# sourceMappingURL=backbone.model.js.map