!function(t){function n(t){var n=[];for(var i in t)n.push(i);return n}function i(t,n,e,s,r){var o,c=0;if(e&&"object"==typeof e){void 0!==s&&"context"in r&&void 0===r.context&&(r.context=s);for(o=Object.keys(e);c<o.length;c++)n=i(t,n,o[c],e[o[c]],r)}else if(e&&f.test(e))for(o=e.split(f);c<o.length;c++)n=t(n,o[c],s,r);else n=t(n,e,s,r);return n}function e(t,n,i,e){if(i){var s=t[n]||(t[n]=[]),r=e.context,o=e.ctx,c=e.listening;c&&c.count++,s.push({callback:i,context:r,ctx:r||o,listening:c})}return t}function s(t,n,i,e){try{t.on(n,i,e)}catch(t){return t}}function r(t,n,i,e){if(t){var s,r=e.context,o=e.listeners,c=0;if(n||r||i){for(s=n?[n]:Object.keys(t);c<s.length;c++){n=s[c];var l=t[n];if(!l)break;for(var h=[],a=0;a<l.length;a++){var f=l[a];if(i&&i!==f.callback&&i!==f.callback._callback||r&&r!==f.context)h.push(f);else{var u=f.listening;u&&u.off(n,i)}}h.length?t[n]=h:delete t[n]}return t}for(s=Object.keys(o);c<s.length;c++)o[s[c]].cleanup()}}function o(t,n,i,e){if(i){var s=t[n]=s(function(){e(n,s),i.apply(this,arguments)});s._callback=i}return t}function c(t,n,i,e){if(t){var s=t[n],r=t.all;s&&r&&(r=r.slice()),s&&l(s,e),r&&l(r,[n].concat(e))}return t}function l(t,n){var i,e=-1,s=t.length,r=n[0],o=n[1],c=n[2];switch(n.length){case 0:for(;++e<s;)(i=t[e]).callback.call(i.ctx);return;case 1:for(;++e<s;)(i=t[e]).callback.call(i.ctx,r);return;case 2:for(;++e<s;)(i=t[e]).callback.call(i.ctx,r,o);return;case 3:for(;++e<s;)(i=t[e]).callback.call(i.ctx,r,o,c);return;default:for(;++e<s;)(i=t[e]).callback.apply(i.ctx,n);return}}function h(t,n){this.id=t._listenId,this.listener=t,this.obj=n,this.interop=!0,this.count=0,this._events=void 0}var a,f=/\s+/;t.Events={on:function(t,n,s){if(this._events=i(e,this._events||{},t,n,{context:s,ctx:this,listening:a}),a){(this._listeners||(this._listeners={}))[a.id]=a,a.interop=!1}return this},listenTo:function(t,n,i){if(!t)return this;var e=t._listenId||(t._listenId=uniqueId("l")),r=this._listeningTo||(this._listeningTo={}),o=a=r[e];o||(this._listenId||(this._listenId=uniqueId("l")),o=a=r[e]=new h(this,t));var c=s(t,n,i,this);if(a=void 0,c)throw c;return o.interop&&o.on(n,i),this},off:function(t,n,e){return this._events?(this._events=i(r,this._events,t,n,{context:e,listeners:this._listeners}),this):this},stopListening:function(t,n,i){var e=this._listeningTo;if(!e)return this;for(var s=t?[t._listenId]:Object.keys(e),r=0;r<s.length;r++){var o=e[s[r]];if(!o)break;o.obj.off(n,i,this),o.interop&&o.off(n,i)}return isEmpty(e)&&(this._listeningTo=void 0),this},once:function(t,n,e){var s=i(o,{},t,n,this.off.bind(this));return"string"==typeof t&&null==e&&(n=void 0),this.on(s,n,e)},listenToOnce:function(t,n,e){var s=i(o,{},n,e,this.stopListening.bind(this,t));return this.listenTo(t,s)},trigger:function(t){if(!this._events)return this;for(var n=Math.max(0,arguments.length-1),e=Array(n),s=0;s<n;s++)e[s]=arguments[s+1];return i(c,this._events,t,void 0,e),this}},h.prototype.on=Events.on,h.prototype.off=function(t,n){var e;this.interop?(this._events=i(r,this._events,t,n,{context:void 0,listeners:void 0}),e=!this._events):(this.count--,e=0===this.count),e&&this.cleanup()},h.prototype.cleanup=function(){delete this.listener._listeningTo[this.obj._listenId],this.interop||delete this.obj._listeners[this.id]}}(this);
//# sourceMappingURL=events.js.map