// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: https://codemirror.net/LICENSE


!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){function t(e,t){return"pairs"==t&&"string"==typeof e?e:"object"==typeof e&&null!=e[t]?e[t]:u[t]}function n(e){for(var t=0;t<e.length;t++){var n=e.charAt(t),i="'"+n+"'";p[i]||(p[i]=r(n))}}function r(e){return function(t){return c(t,e)}}function i(e){var t=e.state.closeBrackets;return!t||t.override?t:e.getModeAt(e.getCursor()).closeBrackets||t}function a(n){var r=i(n);if(!r||n.getOption("disableInput"))return e.Pass;for(var a=t(r,"pairs"),o=n.listSelections(),s=0;s<o.length;s++){if(!o[s].empty())return e.Pass;var l=f(n,o[s].head);if(!l||a.indexOf(l)%2!=0)return e.Pass}for(var s=o.length-1;s>=0;s--){var c=o[s].head;n.replaceRange("",d(c.line,c.ch-1),d(c.line,c.ch+1),"+delete")}}function o(n){var r=i(n),a=r&&t(r,"explode");if(!a||n.getOption("disableInput"))return e.Pass;for(var o=n.listSelections(),l=0;l<o.length;l++){if(!o[l].empty())return e.Pass;var c=f(n,o[l].head);if(!c||a.indexOf(c)%2!=0)return e.Pass}n.operation(function(){var e=n.lineSeparator()||"\n";n.replaceSelection(e+e,null),s(n,-1),o=n.listSelections();for(var t=0;t<o.length;t++){var r=o[t].head.line;n.indentLine(r,null,!0),n.indentLine(r+1,null,!0)}})}function s(e,t){for(var n=[],r=e.listSelections(),i=0,a=0;a<r.length;a++){var o=r[a];o.head==e.getCursor()&&(i=a);var s={line:o.head.line,ch:o.head.ch+t};n.push({anchor:s,head:s})}e.setSelections(n,i)}function l(t){var n=e.cmpPos(t.anchor,t.head)>0;return{anchor:new d(t.anchor.line,t.anchor.ch+(n?-1:1)),head:new d(t.head.line,t.head.ch+(n?1:-1))}}function c(n,r){var a=i(n);if(!a||n.getOption("disableInput"))return e.Pass;var o=t(a,"pairs"),c=o.indexOf(r);if(-1==c)return e.Pass;for(var f,u=t(a,"closeBefore"),p=t(a,"triples"),g=o.charAt(c+1)==r,v=n.listSelections(),b=c%2==0,P=0;P<v.length;P++){var S,k=v[P],y=k.head,O=n.getRange(y,d(y.line,y.ch+1));if(b&&!k.empty())S="surround";else if(!g&&b||O!=r)if(g&&y.ch>1&&p.indexOf(r)>=0&&n.getRange(d(y.line,y.ch-2),y)==r+r){if(y.ch>2&&/\bstring/.test(n.getTokenTypeAt(d(y.line,y.ch-2))))return e.Pass;S="addFour"}else if(g){var m=0==y.ch?" ":n.getRange(d(y.line,y.ch-1),y);if(e.isWordChar(O)||m==r||e.isWordChar(m))return e.Pass;S="both"}else{if(!b||!(0===O.length||/\s/.test(O)||u.indexOf(O)>-1))return e.Pass;S="both"}else S=g&&h(n,y)?"both":p.indexOf(r)>=0&&n.getRange(y,d(y.line,y.ch+3))==r+r+r?"skipThree":"skip";if(f){if(f!=S)return e.Pass}else f=S}var x=c%2?o.charAt(c-1):r,A=c%2?r:o.charAt(c+1);n.operation(function(){if("skip"==f)s(n,1);else if("skipThree"==f)s(n,3);else if("surround"==f){for(var e=n.getSelections(),t=0;t<e.length;t++)e[t]=x+e[t]+A;n.replaceSelections(e,"around"),e=n.listSelections().slice();for(var t=0;t<e.length;t++)e[t]=l(e[t]);n.setSelections(e)}else"both"==f?(n.replaceSelection(x+A,null),n.triggerElectric(x+A),s(n,-1)):"addFour"==f&&(n.replaceSelection(x+x+x+x,"before"),s(n,1))})}function f(e,t){var n=e.getRange(d(t.line,t.ch-1),d(t.line,t.ch+1));return 2==n.length?n:null}function h(e,t){var n=e.getTokenAt(d(t.line,t.ch+1));return/\bstring/.test(n.type)&&n.start==t.ch&&(0==t.ch||!/\bstring/.test(e.getTokenTypeAt(t)))}var u={pairs:"()[]{}''\"\"",closeBefore:")]}'\":;>",triples:"",explode:"[]{}"},d=e.Pos;e.defineOption("autoCloseBrackets",!1,function(r,i,a){a&&a!=e.Init&&(r.removeKeyMap(p),r.state.closeBrackets=null),i&&(n(t(i,"pairs")),r.state.closeBrackets=i,r.addKeyMap(p))});var p={Backspace:a,Enter:o};n(u.pairs+"`")});
//# sourceMappingURL=closebrackets.js.map